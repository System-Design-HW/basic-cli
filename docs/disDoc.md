# Архитектурная документация CLI

## 1. Общая информация

### 1.1. Назначение документа

Документ описывает архитектуру CLI-интерпретатора, разработанного для выполнения встроенных команд (`cat`, `echo`, `wc`, `pwd`, `exit`) и вызова внешних программ. Документ включает описание компонентов системы, их взаимодействие, принятые архитектурные решения, альтернативы, преимущества и риски.

### 1.2. Описание системы

**Название системы:** Интерпретатор командной строки (CLI)  
**Описание:** CLI представляет собой систему обработки команд, поддерживающую выполнение встроенных команд (`cat`, `echo`, `wc`, `pwd`, `exit`) и вызов внешних программ. Команды могут объединяться с помощью пайплайнов (`|`). Система работает исключительно в командной строке и не включает графический интерфейс.

---

## 2. Стейкхолдеры и их интересы

### 2.1. Стейкхолдеры

| Стейкхолдер       | Интерес                                                                                 |
|-------------------|-----------------------------------------------------------------------------------------|
| Пользователи      | Удобство работы с CLI, простота использования, возможность выполнения команд и скриптов |
| Разработчики      | Простота поддержки, четкая архитектура, расширяемость и модульность                    |
| Владельцы проекта | Стабильность работы, соответствие требованиям                                           |
| Сопровождающие    | Легкость поддержки, документированность кода, тестируемость                             |

### 2.2. Влияние архитектуры на стейкхолдеров

- Модульная структура системы упрощает сопровождение и расширение функциональности.
- Использование стандартных механизмов работы с процессами (`fork()`, `pipe`) обеспечивает предсказуемость и надежность выполнения команд.
- Поддержка пайплайнов делает CLI более удобным для пользователей.

---

## 3. Viewpoints

### 3.1. Структурный вид

На [структурной диаграмме](./images/CLI-Arch.png) показаны основные компоненты системы и их взаимодействие:

- **CLIManager** – управляет интерпретатором, запускает парсинг и выполнение команд.
- **Parser** – разбирает входную строку на токены, учитывая заданные требования.
- **Executor** – выполняет команды, полученные от `Parser`.
- **Command** – интерфейс для выполнения команд.
- **Реализации Command** – классы для встроенных команд (`CatCommand`, `EchoCommand`, `WcCommand`, `PwdCommand`, `ExitCommand`) и `DefaultCommand` для внешних программ.

### 3.2. Process View

На диаграмме последовательности показан поток выполнения:

1. Пользователь вводит команду.
2. `CLIManager` передает строку в `Parser`.
3. `Parser` разбирает строку на токены и возвращает список команд.
4. `Executor` выполняет команды:
   - Для встроенных команд используются соответствующие классы, реализующие интерфейс `Command`.
   - Для внешних команд используется `DefaultCommand`.
5. Для работы с пайплайнами используются системные вызовы `fork()` и `pipe`.
6. Результат выполнения команды выводится на экран.

### 3.3. Контекстный вид

Взаимодействие системы CLI с внешними сущностями:

- **Пользователь:** Взаимодействует с CLI через командную строку, вводя команды и получая результаты.
- **Операционная система:** CLI использует системные вызовы для выполнения команд и управления процессами.
- **Внешние программы:** CLI вызывает внешние программы через механизмы операционной системы.

---

## 4. Обоснование архитектуры

### 4.1. Принятые решения

- **Использование интерфейса `Command`:**
  - Преимущества: Упрощает добавление новых команд, обеспечивает единый интерфейс для выполнения.
  - Риски: Нет.

- **Обработка пайплайнов через `fork()` и `pipe`:**
  - Преимущества: Стандартный механизм, обеспечивающий надежность и предсказуемость.
  - Риски: Зависимость от возможностей операционной системы.

- **Модульная архитектура:**
  - Преимущества: Упрощает поддержку, тестирование и расширение функциональности.
  - Недостатки: Требует большего проектирования на ранних этапах.

### 4.2. Альтернативы

- **Объединение всех функций в одном классе:**
  - Преимущества: Простота начальной реализации.
  - Недостатки: Сложность поддержки и расширения, низкая модульность.

- **Использование других механизмов для пайплайнов:**
  - Преимущества: Возможность использования более высокоуровневых API.
  - Недостатки: Меньше контроля над процессами.

---

## 5. Риски и пути их минимизации

| Риск                            | Возможные последствия                                         | Меры минимизации                                         |
|---------------------------------|---------------------------------------------------------------|----------------------------------------------------------|
| Ошибки в разборе команд         | Некорректное выполнение команд                                | Покрытие тестами парсера, логирование                    |
| Зависимость от внешних программ | Если внешняя программа недоступна, команда не будет выполнена | Обработка ошибок процессов, вывод сообщений пользователю |

---

## 6. Требования

### 6.1. Функциональные требования

- Поддержка встроенных команд (`cat`, `echo`, `wc`, `pwd`, `exit`).
- Поддержка вызова внешних программ.
- Поддержка пайплайнов.

### 6.2. Нефункциональные требования

- Кроссплатформенность (Linux, macOS, Windows).
- Простота расширения (добавление новых команд).
- Надежность (обработка ошибок и логирование).

---

## 7. Эволюция системы

Система разработана с учетом возможного расширения:

- Добавление новых встроенных команд (например, `grep`).
- Поддержка дополнительных операторов (например, `&&`, `||`).
- Расширение механизма работы с переменными окружения.

---

## 8. Дополнения

### 8.1. Диаграммы

- [Диаграмма архитектуры](./images/CLI-Arch.png)

### 8.2. Глоссарий

- **Пайплайн:** Последовательность команд, соединенных оператором `|`.
- **CLI:** Интерфейс командной строки, позволяющий пользователю взаимодействовать с системой через текстовые команды.
- **Токенизация:** Процесс разбиения входной строки на отдельные элементы (токены).
- **Executor:** Компонент системы, отвечающий за выполнение команд.
- **Parser:** Компонент системы, отвечающий за разбор пользовательского ввода.
- **Command:** Интерфейс для выполнения команд.

---
